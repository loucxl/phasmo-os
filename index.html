<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHASMO.OS // Complete Investigation Suite</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>

    <header>
        <div class="brand">
            <div class="live-dot"></div>
            PHASMO<span>.OS</span>
            <div class="version">v2.1</div>
        </div>
        <nav class="header-nav">
            <button class="nav-btn" onclick="showSection('ghosts')">üëª Ghosts</button>
            <button class="nav-btn" onclick="showSection('maps')">üó∫Ô∏è Maps</button>
            <button class="nav-btn" onclick="showSection('equipment')">üî¶ Equipment</button>
            <button class="nav-btn" onclick="showSection('mechanics')">‚öôÔ∏è Mechanics</button>
            <button class="nav-btn" onclick="showSection('strategy')">üìã Strategy</button>
        </nav>
        <div class="header-tools">
            <button class="btn-group" id="btnGroupJournal" title="Group Journal">üîó</button>
            <button class="btn-icon" id="btnManual" title="Hunter's Manual">üìñ</button>
            <button class="btn-reset" id="btnReset">Reset</button>
            
            <!-- Auth Section (Compact) -->
            <div id="authView" class="header-auth">
                <button class="btn-login" id="btnGoogleLogin">Login</button>
            </div>
            <div id="userView" class="header-auth" style="display: none;">
                <button class="btn-user" id="btnUserMenu">
                    <img class="user-avatar-small" id="userAvatar" src="" alt="">
                    <span class="user-nickname-compact" id="userNickname">User</span>
                    <span class="user-level-badge">Lvl <span id="userLevel">1</span></span>
                </button>
            </div>
        </div>
    </header>
    <!-- WORK IN PROGRESS BANNER -->
    <div class="wip-banner">
        <div class="wip-content">
            <span class="wip-icon">‚ö†Ô∏è</span>
            <div class="wip-text">
                <strong>Winter's Jest Update (Dec 2025):</strong> Site updated with 3 new ghosts (Dayan, Gallu, Obambo). 
                Core functionality works as intended, but additional content sections are still being refined.
            </div>
        </div>
    </div>


    <!-- GHOSTS SECTION (Default) -->
    <div class="main-section" id="section-ghosts" style="display: flex;">
        <div class="controls-wrapper">
            <div class="evidence-bar" id="evBar"></div>
            <div class="filters-row" id="filterRow"></div>
        </div>

        <div class="dashboard-container">
            <div class="status-header">
                <div><span id="matchCount">27</span> Candidates</div>
                <div class="quick-stats">
                    <span class="stat-badge">Evidence: <span id="evCount">0</span>/3</span>
                    <span class="stat-badge">Filters: <span id="filterCount">0</span></span>
                </div>
            </div>
            <div class="ghost-grid" id="ghostGrid"></div>
        </div>
    </div>

    <!-- MAPS SECTION -->
    <div class="main-section" id="section-maps" style="display: none;">
        <div class="section-container">
            <h2 class="page-title">üìç MAP DATABASE</h2>
            
            <div class="maps-category">
                <h3 class="category-header">SMALL MAPS (Starter Friendly)</h3>
                <div class="map-grid">
                    <div class="map-card">
                        <div class="map-header">
                            <h4>Tanglewood Street House</h4>
                            <span class="difficulty">‚òÖ‚òÜ‚òÜ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">8 Rooms</span>
                            <span class="info-tag">1 Bone</span>
                        </div>
                        <p class="map-desc">Tutorial map. Single-floor layout with basement. Great for learning basics. Truck is very close.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Bedroom closets, basement storage, garage<br>
                            <strong>Tips:</strong> Perfect for beginners. Small enough to cover quickly.
                        </div>
                    </div>

                    <div class="map-card">
                        <div class="map-header">
                            <h4>Edgefield Street House</h4>
                            <span class="difficulty">‚òÖ‚òÜ‚òÜ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">9 Rooms</span>
                        </div>
                        <p class="map-desc">Similar to Tanglewood. Small suburban house with garage and attic access.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Multiple closets, garage, attic<br>
                            <strong>Tips:</strong> Slightly larger with more vertical exploration.
                        </div>
                    </div>

                    <div class="map-card">
                        <div class="map-header">
                            <h4>Bleasdale Farmhouse</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÜ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">12 Rooms</span>
                        </div>
                        <p class="map-desc">Rural farmhouse with attic. More complex than street houses. Watch for breaker location.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Attic corners, bedroom closets, pantry<br>
                            <strong>Tips:</strong> Larger small map. Attic can be tricky to navigate.
                        </div>
                    </div>
                </div>
            </div>

            <div class="maps-category">
                <h3 class="category-header">MEDIUM MAPS (Intermediate Challenge)</h3>
                <div class="map-grid">
                    <div class="map-card">
                        <div class="map-header">
                            <h4>Brownstone High School</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÜ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">30 Rooms</span>
                        </div>
                        <p class="map-desc">High school with classrooms, gym, cafeteria. Long hallways make hunts dangerous.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Bathroom stalls, classroom closets, some lockers<br>
                            <strong>Tips:</strong> Use sound sensors. Watch hallways during hunts.
                        </div>
                    </div>

                    <div class="map-card">
                        <div class="map-header">
                            <h4>Prison</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÖ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">28 Rooms</span>
                        </div>
                        <p class="map-desc">Abandoned prison. Multiple cell blocks. VERY dark. Poltergeist is deadly here.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Prison cells, closets, bathrooms<br>
                            <strong>Tips:</strong> Bring EXTRA lights. Cells look identical - use landmarks.
                        </div>
                    </div>

                    <div class="map-card">
                        <div class="map-header">
                            <h4>Maple Lodge Campsite</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÖ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">1 Floor</span>
                            <span class="info-tag">22 Areas</span>
                        </div>
                        <p class="map-desc">Outdoor campground. NO indoor safety. Freezing temps everywhere in winter.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Cabins, tents (limited protection)<br>
                            <strong>Tips:</strong> Entirely outdoor. Unique mechanics. Very challenging.
                        </div>
                    </div>
                </div>
            </div>

            <div class="maps-category">
                <h3 class="category-header">LARGE MAPS (Expert Only)</h3>
                <div class="map-grid">
                    <div class="map-card highlight-danger">
                        <div class="map-header">
                            <h4>Sunny Meadows Mental Institution</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÖ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">2 Floors</span>
                            <span class="info-tag">70+ Rooms</span>
                            <span class="info-tag">2 Cursed Items</span>
                        </div>
                        <p class="map-desc">MASSIVE asylum. Longest investigations. Team coordination ESSENTIAL. Split up to find ghost.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Patient rooms throughout, many closets<br>
                            <strong>Tips:</strong> Motion sensors essential. Can take 20+ mins to find ghost.
                        </div>
                    </div>

                    <div class="map-card">
                        <div class="map-header">
                            <h4>Point Hope</h4>
                            <span class="difficulty">‚òÖ‚òÖ‚òÖ</span>
                        </div>
                        <div class="map-info">
                            <span class="info-tag">1 Floor</span>
                            <span class="info-tag">18 Areas</span>
                        </div>
                        <p class="map-desc">Lighthouse island. Weather effects. Indoor/outdoor mix. Unique layout.</p>
                        <div class="map-tips">
                            <strong>Hiding Spots:</strong> Lighthouse interior, keeper's house<br>
                            <strong>Tips:</strong> Weather impacts gameplay. Spread out spaces.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- EQUIPMENT SECTION -->
    <div class="main-section" id="section-equipment" style="display: none;">
        <div class="section-container">
            <h2 class="page-title">üî¶ EQUIPMENT DATABASE</h2>
            
            <div class="equip-tabs">
                <button class="tab-btn active" onclick="switchEquipTab('detection')">Detection</button>
                <button class="tab-btn" onclick="switchEquipTab('protection')">Protection</button>
                <button class="tab-btn" onclick="switchEquipTab('utility')">Utility</button>
            </div>

            <div id="equip-content"></div>
        </div>
    </div>

    <!-- MECHANICS SECTION -->
    <div class="main-section" id="section-mechanics" style="display: none;">
        <div class="section-container">
            <h2 class="page-title">‚öôÔ∏è GAME MECHANICS</h2>
            
            <div class="mechanics-grid">
                <div class="mechanic-card">
                    <h3>üß† SANITY SYSTEM</h3>
                    <div class="mechanic-content">
                        <h4>Starting Sanity</h4>
                        <ul>
                            <li>Amateur - Nightmare: <span class="hl-green">100%</span></li>
                            <li>Insanity: <span class="hl-red">0%</span></li>
                        </ul>
                        
                        <h4>Passive Drain</h4>
                        <ul>
                            <li>Lights OFF: <span class="hl-red">-0.12%/s</span></li>
                            <li>Lights ON: <span class="hl-green">0%/s</span></li>
                            <li>Near Candle: <span class="hl-green">0%/s</span></li>
                        </ul>
                        
                        <h4>Hunt Thresholds</h4>
                        <ul>
                            <li>Standard: 50%</li>
                            <li>Demon: 70%</li>
                            <li>Mare: 60% (dark) / 40% (light)</li>
                            <li>Shade: 35%</li>
                            <li>Yokai: 80% (when talking)</li>
                        </ul>
                        
                        <h4>Restoration</h4>
                        <ul>
                            <li>Sanity Pills: +25%</li>
                            <li>Tarot Sun: +100%</li>
                        </ul>
                    </div>
                </div>

                <div class="mechanic-card">
                    <h3>‚öîÔ∏è HUNT MECHANICS</h3>
                    <div class="mechanic-content">
                        <h4>Ghost Speeds</h4>
                        <ul>
                            <li>Baseline: 1.7 m/s</li>
                            <li>Player Sprint: 3.0 m/s</li>
                            <li>Revenant (LoS): 3.0 m/s</li>
                            <li>Deogen (close): 0.4 m/s</li>
                            <li>Jinn/Raiju (boosted): 2.5 m/s</li>
                            <li>Hantu (cold): up to 2.7 m/s</li>
                        </ul>
                        
                        <h4>Detection Range</h4>
                        <ul>
                            <li>Sight: Line of sight = chase</li>
                            <li>Electronics: 12m (Yokai: 2.5m)</li>
                            <li>Voice: 12m (Yokai: 2.5m)</li>
                            <li>Footsteps: Audible to ghost</li>
                        </ul>
                        
                        <h4>Hunt Duration</h4>
                        <ul>
                            <li>Standard: 30-45 seconds</li>
                            <li>Cooldown: 25s (Demon: 20s)</li>
                        </ul>
                    </div>
                </div>

                <div class="mechanic-card">
                    <h3>üé≤ DIFFICULTY MODIFIERS</h3>
                    <div class="mechanic-content">
                        <h4>Amateur (1.0x)</h4>
                        <ul>
                            <li>Setup: 5 minutes</li>
                            <li>Grace: 5 minutes</li>
                            <li>Fingerprints: 60s</li>
                            <li>Death: No penalty</li>
                        </ul>
                        
                        <h4>Intermediate (2.0x)</h4>
                        <ul>
                            <li>Setup: 2 minutes</li>
                            <li>Grace: 2 minutes</li>
                            <li>Death: Lose equipment</li>
                        </ul>
                        
                        <h4>Professional (3.0x)</h4>
                        <ul>
                            <li>Setup: 0 minutes</li>
                            <li>Grace: 0 minutes</li>
                            <li>Fusebox: Starts OFF</li>
                            <li>Death: Lose equipment + money</li>
                        </ul>
                        
                        <h4>Nightmare (4.0x)</h4>
                        <ul>
                            <li><span class="hl-red">2 evidence only!</span></li>
                            <li>Fingerprints: 30s</li>
                            <li>Electronics malfunction</li>
                            <li>No D.O.T.S visual</li>
                        </ul>
                        
                        <h4>Insanity (0.0x)</h4>
                        <ul>
                            <li><span class="hl-red">0% starting sanity</span></li>
                            <li>Pills do nothing</li>
                            <li>No rewards (challenge only)</li>
                        </ul>
                    </div>
                </div>

                <div class="mechanic-card">
                    <h3>üîÆ CURSED POSSESSIONS</h3>
                    <div class="mechanic-content">
                        <h4>Ouija Board</h4>
                        <p>Ask questions. 5-25% sanity per question. Say "Goodbye" or hunt!</p>
                        
                        <h4>Music Box</h4>
                        <p>Wind to summon. Ghost walks toward you. DON'T hold until empty!</p>
                        
                        <h4>Summoning Circle</h4>
                        <p>Light all candles = ghost appears + GUARANTEED HUNT.</p>
                        
                        <h4>Voodoo Doll</h4>
                        <p>10 pins. Each = interaction. HEART PIN = HUNT!</p>
                        
                        <h4>Monkey Paw</h4>
                        <p>5 wishes. All have curses. Very risky!</p>
                        
                        <h4>Tarot Cards</h4>
                        <p>Random effects. Tower/Death = hunt. Sun = full sanity.</p>
                        
                        <h4>Haunted Mirror</h4>
                        <p>Shows ghost location. MASSIVE sanity drain. Quick glances only!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STRATEGY SECTION -->
    <div class="main-section" id="section-strategy" style="display: none;">
        <div class="section-container">
            <h2 class="page-title">üìã STRATEGY GUIDE</h2>
            
            <div class="strategy-phase">
                <h3 class="phase-header">üéØ EARLY GAME (Setup Phase)</h3>
                <div class="strategy-content">
                    <ul>
                        <li>Locate ghost room using thermometer sweeps (coldest room)</li>
                        <li>Place equipment strategically: EMF reader, writing book, DOTS</li>
                        <li>Work as team to cover more ground faster</li>
                        <li>Manage sanity - stay in lit areas during setup</li>
                        <li>Use motion/sound sensors on large maps to track roaming</li>
                        <li>Identify 1-2 evidence pieces before pushing deeper</li>
                    </ul>
                </div>
            </div>

            <div class="strategy-phase">
                <h3 class="phase-header">‚ö° MID GAME (Evidence Collection)</h3>
                <div class="strategy-content">
                    <ul>
                        <li>Saturate ghost room with all relevant detection tools</li>
                        <li>Use smudge sticks to prevent hunts while investigating</li>
                        <li>Complete easy objectives first (photos, motion sensor)</li>
                        <li>Monitor sanity closely - know your hunt threshold</li>
                        <li>Communicate evidence found and suspected ghosts with team</li>
                        <li>Test specific ghost abilities (smudge timer, salt footprints)</li>
                    </ul>
                </div>
            </div>

            <div class="strategy-phase">
                <h3 class="phase-header">üèÅ LATE GAME (Identification & Exit)</h3>
                <div class="strategy-content">
                    <ul>
                        <li>With 3 evidence, identify ghost and GET OUT</li>
                        <li>Don't get greedy with objectives at low sanity</li>
                        <li>Use crucifixes and smudge sticks defensively</li>
                        <li>Have escape routes planned from all locations</li>
                        <li>Solo players: Know your hiding spots and exit paths</li>
                        <li>If unsure between 2 ghosts, use behavior tests</li>
                    </ul>
                </div>
            </div>

            <div class="strategy-phase">
                <h3 class="phase-header">üéì ADVANCED TECHNIQUES</h3>
                <div class="strategy-content">
                    <ul>
                        <li>Master ghost-specific tests (Spirit 180s, Wraith no prints, etc)</li>
                        <li>Use cursed possessions strategically for bonus evidence/photos</li>
                        <li>Learn looping patterns for fast ghosts (Revenant, Jinn)</li>
                        <li>Understand LoS mechanics - break vision to reset chase</li>
                        <li>On Nightmare, use behavior + 2 evidence to eliminate options</li>
                        <li>Practice solo investigations to understand ghost behavior better</li>
                        <li>Use parabolic mic to identify Banshee/Moroi instantly</li>
                        <li>Leverage ghost weaknesses (Mare light sensitivity, etc)</li>
                    </ul>
                </div>
            </div>

            <div class="strategy-phase">
                <h3 class="phase-header">‚ö†Ô∏è SURVIVAL TIPS</h3>
                <div class="strategy-content">
                    <div class="tip-grid">
                        <div class="tip-card">
                            <h4>During Hunts</h4>
                            <ul>
                                <li>Break line of sight immediately</li>
                                <li>Hide in closets/lockers (close door, stay quiet)</li>
                                <li>Loop furniture vs slow ghosts</li>
                                <li>Smudge to blind and slow ghost</li>
                                <li>Turn OFF electronics (flashlight, etc)</li>
                                <li>Don't talk - ghost hears you</li>
                            </ul>
                        </div>
                        <div class="tip-card">
                            <h4>Sanity Management</h4>
                            <ul>
                                <li>Stay in lit areas when possible</li>
                                <li>Light candles for safe zones</li>
                                <li>Save pills for after evidence</li>
                                <li>Avoid staring at Phantom</li>
                                <li>Leave before critical (25%) sanity</li>
                                <li>Use pills to slow Moroi</li>
                            </ul>
                        </div>
                        <div class="tip-card">
                            <h4>Equipment Usage</h4>
                            <ul>
                                <li>Place crucifixes in ghost room center</li>
                                <li>Smudge in ghost room for 90s safety</li>
                                <li>Drop EMF reader, don't carry it</li>
                                <li>Use glowsticks for constant UV coverage</li>
                                <li>Salt in doorways tracks roaming</li>
                                <li>Multiple cameras = better Orb detection</li>
                            </ul>
                        </div>
                        <div class="tip-card">
                            <h4>Map-Specific</h4>
                            <ul>
                                <li>Small maps: Quick in-and-out</li>
                                <li>Medium maps: Use sensors to track</li>
                                <li>Large maps: Split team, motion sensors essential</li>
                                <li>Prison: Bring EXTRA lights</li>
                                <li>Maple/Campsite: No true safety</li>
                                <li>Asylum: Can take 20+ minutes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER (Timer) -->
    <div class="footer">
        <button class="timer-play" id="timerBtn">‚ñ∂</button>
        <div class="timer-center">
            <div class="timer-label">HUNT COOLDOWN</div>
            <div class="timer-val" id="timerDisplay">90</div>
            <div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
        </div>
        <div class="timer-opts">
            <button class="t-opt active" data-time="90">Smudge</button>
            <button class="t-opt" data-time="180">Spirit</button>
            <button class="t-opt" data-time="60">Demon</button>
            <button class="t-opt" data-time="25">Cooldown</button>
        </div>
    </div>

    <!-- Ghost Details Modal -->
    <dialog id="ghostModal">
        <div class="dialog-header">
            <h2 class="dialog-title" id="mName">GHOST</h2>
            <button class="dialog-close" id="closeGhost">&times;</button>
        </div>
        <div class="dialog-body" id="mContent"></div>
    </dialog>

    <!-- Group Journal Modal -->
    <dialog id="groupModal">
        <div class="dialog-header">
            <h2 class="dialog-title">üîó GROUP JOURNAL</h2>
            <button class="dialog-close" id="closeGroup">&times;</button>
        </div>
        <div class="dialog-body">
            <div id="groupContent">
                <div class="group-option">
                    <h3>Create New Session</h3>
                    <p>Start a new group journal and share the link with your team.</p>
                    <button class="btn-primary" id="btnCreateSession">Create Session</button>
                </div>
                <div class="group-divider">OR</div>
                <div class="group-option">
                    <h3>Join Existing Session</h3>
                    <p>Enter a session ID to join an ongoing investigation.</p>
                    <input type="text" id="joinSessionInput" placeholder="Enter session ID...">
                    <button class="btn-primary" id="btnJoinSession">Join Session</button>
                </div>
            </div>
            <div id="activeSession" style="display: none;">
                <div class="session-info">
                    <div class="session-status">
                        <span class="status-dot"></span>
                        <span>Connected to Group Session</span>
                    </div>
                    <div class="session-details">
                        <div class="session-id">Session: <span id="currentSessionId"></span></div>
                        <div class="session-users">
                            <div class="users-header">
                                üë• <span id="userCount">1</span> investigator(s) connected:
                            </div>
                            <div class="users-list" id="usersList">
                                <!-- Nicknames will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="share-section">
                    <label>Share this link with your team:</label>
                    <div class="share-input-group">
                        <input type="text" id="shareLink" readonly>
                        <button class="btn-copy" id="btnCopyLink">Copy</button>
                    </div>
                </div>
                <button class="btn-danger" id="btnLeaveSession">Leave Session</button>
            </div>
        </div>
    </dialog>

    <!-- Manual Modal -->
    <dialog id="manualModal">
        <div class="dialog-header">
            <h2 class="dialog-title">HUNTER'S MANUAL</h2>
            <button class="dialog-close" id="closeManual">&times;</button>
        </div>
        <div class="dialog-body">
            <div class="manual-nav">
                <button class="nav-btn active" onclick="showManualTab('ev', this)">Evidence</button>
                <button class="nav-btn" onclick="showManualTab('cursed', this)">Cursed Items</button>
                <button class="nav-btn" onclick="showManualTab('sanity', this)">Sanity</button>
                <button class="nav-btn" onclick="showManualTab('equip', this)">Equipment</button>
            </div>
            <div id="manualContent"></div>
        </div>
    </dialog>

    <script>
        // Section switching
        function showSection(section) {
            document.querySelectorAll('.main-section').forEach(s => s.style.display = 'none');
            document.getElementById(`section-${section}`).style.display = 'flex';
            document.querySelectorAll('.header-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Initialize equipment section if switching to it
            if (section === 'equipment') {
                setTimeout(() => {
                    if (window.showEquipTab) {
                        window.showEquipTab('detection');
                    }
                }, 50);
            }
        }

        // Equipment tab switching helper - calls the main function from script.js
        function switchEquipTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if (window.showEquipTab) {
                window.showEquipTab(tab);
            }
        }
    </script>

    <script src="script.js"></script>
</body>
</html>

    <!-- Nickname Setup Modal -->
    <dialog id="nicknameModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">üëª Choose Your Hunter Name</h2>
        </div>
        <div class="dialog-body">
            <p style="color: var(--text-muted); margin-bottom: 16px;">
                This is the name other investigators will see in group sessions.
            </p>
            <form id="nicknameForm" class="auth-form">
                <div class="form-group">
                    <label>Nickname</label>
                    <input type="text" id="nicknameInput" required 
                           placeholder="Ghost Hunter" 
                           maxlength="20"
                           pattern="[A-Za-z0-9 _-]+"
                           title="Only letters, numbers, spaces, - and _">
                    <small>3-20 characters, letters and numbers only</small>
                </div>
                <div class="form-error" id="nicknameError"></div>
                <button type="submit" class="btn-primary">Set Nickname</button>
            </form>
        </div>
    </dialog>

    <!-- Stats Modal -->
    <dialog id="statsModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">üìä <span id="statsNickname">Your</span> Stats</h2>
            <button class="dialog-close" id="closeStats">&times;</button>
        </div>
        <div class="dialog-body">
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Investigations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statWins">0</div>
                    <div class="stat-label">Correct Guesses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statLosses">0</div>
                    <div class="stat-label">Incorrect Guesses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statWinRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
            </div>
            
            <!-- Level Display -->
            <div class="level-display">
                <div class="level-info">
                    <span class="level-badge">‚≠ê Level <span id="statLevel">1</span></span>
                    <span class="xp-text"><span id="statXP">0</span> / <span id="statXPNext">500</span> XP</span>
                </div>
                <div class="xp-bar">
                    <div class="xp-bar-fill" id="xpBarFill"></div>
                </div>
            </div>
            
            <button class="btn-secondary" id="btnChangeNickname" style="margin-bottom: 16px;">
                Change Nickname
            </button>
            
            <button class="btn-danger" id="btnResetStats" style="margin-bottom: 16px;">
                Reset All Stats
            </button>
            
            <h3 style="color: var(--text-main); margin-bottom: 12px;">Recent Investigations</h3>
            <div class="history-list" id="historyList">
                <div class="empty-state">No investigations yet. Start hunting ghosts!</div>
            </div>
            
            <button class="btn-primary" id="btnNewInvestigation">Start New Investigation</button>
        </div>
    </dialog>

    <!-- Submit Guess Modal -->
    <dialog id="guessModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">What Ghost Was It?</h2>
            <button class="dialog-close" id="closeGuess">&times;</button>
        </div>
        <div class="dialog-body">
            <p style="color: var(--text-muted); margin-bottom: 16px;">
                You've narrowed it down! What ghost do you think it is?
            </p>
            <div id="ghostOptions" class="ghost-options">
                <!-- Will be populated with remaining ghosts -->
            </div>
        </div>
    </dialog>


    <!-- User Dropdown Menu -->
    <div class="user-dropdown" id="userDropdown" style="display: none;">
        <div class="dropdown-header">
            <img class="dropdown-avatar" id="dropdownAvatar" src="" alt="">
            <div>
                <div class="dropdown-name" id="dropdownNickname">User</div>
                <div class="dropdown-stats">
                    <span>üèÜ <span id="dropdownWins">0</span> wins</span>
                    <span>üìä <span id="dropdownWinRate">0</span>%</span>
                </div>
            </div>
        </div>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" id="btnViewStatsDropdown">
            <span>üìä</span> View Stats
        </button>
        <button class="dropdown-item" id="btnLogoutDropdown">
            <span>üö™</span> Logout
        </button>
    </div>


    <!-- Friends Modal -->
    <dialog id="friendsModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">üë• Friends</h2>
            <button class="dialog-close" id="closeFriends">&times;</button>
        </div>
        <div class="dialog-body">
            <!-- Your Friend Code -->
            <div class="friend-code-section">
                <div class="friend-code-label">Your Friend Code:</div>
                <div class="friend-code-display">
                    <span class="friend-code-text" id="yourFriendCode">Loading...</span>
                    <button class="btn-copy-code" id="btnCopyFriendCode">Copy</button>
                </div>
                <small style="color: var(--text-muted);">Share this code with friends to add them!</small>
            </div>
            
            <!-- Friends List -->
            <div class="friends-section">
                <h3>Friends (<span id="friendsCount">0</span>)</h3>
                <div id="friendsList" class="friends-list">
                    <div class="empty-state">Loading...</div>
                </div>
            </div>
            
            <!-- Friend Requests -->
            <div class="requests-section">
                <h3>Requests (<span id="requestsCount">0</span>)</h3>
                <div id="friendRequestsList" class="requests-list">
                    <div class="empty-state">No pending requests</div>
                </div>
            </div>
            
            <button class="btn-primary" id="btnAddFriend">‚ûï Add Friend</button>
        </div>
    </dialog>

    <!-- Add Friend Modal -->
    <dialog id="addFriendModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">‚ûï Add Friend</h2>
            <button class="dialog-close" id="closeAddFriend">&times;</button>
        </div>
        <div class="dialog-body">
            <p style="color: var(--text-muted); margin-bottom: 16px;">
                Enter your friend's code to send them a friend request.
            </p>
            <form id="addFriendForm" class="auth-form">
                <div class="form-group">
                    <label>Friend Code</label>
                    <input type="text" id="friendCodeInput" required 
                           placeholder="ABCD-1234" 
                           maxlength="9"
                           pattern="[A-Z]{4}-[0-9]{4}"
                           style="text-transform: uppercase; font-family: var(--font-mono); font-size: 1.2rem; letter-spacing: 2px; text-align: center;"
                           title="Format: ABCD-1234">
                    <small>Format: 4 letters, dash, 4 numbers (e.g. ABCD-1234)</small>
                </div>
                <div class="form-error" id="addFriendError"></div>
                <button type="submit" class="btn-primary">Send Friend Request</button>
            </form>
        </div>
    </dialog>


    <!-- Friend Stats Modal -->
    <dialog id="friendStatsModal" class="auth-modal">
        <div class="dialog-header">
            <h2 class="dialog-title">üë§ <span id="friendStatsNickname">Friend</span>'s Stats</h2>
            <button class="dialog-close" onclick="document.getElementById('friendStatsModal').close()">&times;</button>
        </div>
        <div class="dialog-body">
            <!-- Friend Avatar & Level -->
            <div style="text-align: center; margin-bottom: 24px;">
                <img id="friendStatsAvatar" src="" alt="" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--acc-cyan); margin-bottom: 12px;">
                <div style="font-family: var(--font-hud); font-size: 1.2rem; color: var(--acc-cyan); font-weight: 900;">
                    ‚≠ê Level <span id="friendStatLevel">1</span>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="friendStatTotal">0</div>
                    <div class="stat-label">Total Investigations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="friendStatWins">0</div>
                    <div class="stat-label">Correct Guesses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="friendStatLosses">0</div>
                    <div class="stat-label">Incorrect Guesses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="friendStatWinRate">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding: 16px; background: var(--bg-elevated); border-radius: 8px; font-family: var(--font-mono); color: var(--text-muted);">
                <span id="friendStatXP">0 / 500 XP</span>
            </div>
        </div>
    </dialog>

